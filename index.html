<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bike Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase SDKs (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; padding:20px; }
    h1,h2 { text-align:center; }
    .card { background:#1c1c1c; padding:16px; border-radius:8px; margin-bottom:16px; }
    input, textarea, button { width:100%; padding:8px; margin-top:6px; background:#2a2a2a; color:#fff; border:none; border-radius:4px; }
    button { background:#ff9800; font-weight:bold; cursor:pointer; }
    button:hover { background:#ffa726; }
    table { width:100%; border-collapse:collapse; }
    th,td { border-bottom:1px solid #333; padding:8px; font-size:14px; }
    #app { display:none; }
    .error { color:#ff5252; margin-top:8px; font-size:13px; }
    .info  { color:#81c784; margin-top:8px; font-size:13px; }
  </style>
</head>
<body>

<h1>Bike Manager</h1>

<div id="login" class="card">
  <h2>Login / Register</h2>
  <input id="email" type="email" placeholder="Email" autocomplete="email" />
  <input id="password" type="password" placeholder="Password (min 6 chars)" autocomplete="current-password" />
  <button id="loginBtn">Login / Register</button>
  <div id="loginMsg" class="error"></div>
</div>

<div id="app">
  <div class="card">
    <h2>Add Bike</h2>
    <input id="bikeName" placeholder="Bike Name" />
    <textarea id="engine" placeholder="Engine Specs"></textarea>
    <button id="saveBikeBtn">Save Bike</button>
    <div id="bikeMsg" class="info"></div>
  </div>

  <div class="card">
    <h2>Your Bikes</h2>
    <table>
      <thead><tr><th>Name</th><th>Engine</th></tr></thead>
      <tbody id="bikeList"></tbody>
    </table>
  </div>

  <button id="logoutBtn">Logout</button>
</div>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: ""
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db   = firebase.firestore();

  const loginDiv    = document.getElementById('login');
  const appDiv      = document.getElementById('app');
  const emailInput  = document.getElementById('email');
  const passInput   = document.getElementById('password');
  const loginBtn    = document.getElementById('loginBtn');
  const loginMsg    = document.getElementById('loginMsg');
  const bikeNameInp = document.getElementById('bikeName');
  const engineInp   = document.getElementById('engine');
  const saveBikeBtn = document.getElementById('saveBikeBtn');
  const bikeMsg     = document.getElementById('bikeMsg');
  const bikeListTbody = document.getElementById('bikeList');
  const logoutBtn   = document.getElementById('logoutBtn');

  let bikesUnsub = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      loginDiv.style.display = 'none';
      appDiv.style.display = 'block';
      loginMsg.textContent = '';
      startBikeListener(user.uid);
    } else {
      appDiv.style.display = 'none';
      loginDiv.style.display = 'block';
      stopBikeListener();
      bikeListTbody.innerHTML = '';
    }
  });

  async function handleLogin() {
    loginMsg.textContent = '';
    const email = emailInput.value.trim();
    const pass  = passInput.value.trim();

    if (!email || !pass) {
      loginMsg.textContent = 'Please enter email and password.';
      return;
    }
    if (pass.length < 6) {
      loginMsg.textContent = 'Password must be at least 6 characters.';
      return;
    }

    try {
      await auth.signInWithEmailAndPassword(email, pass);
    } catch (err) {
      if (err.code === 'auth/user-not-found') {
        try {
          await auth.createUserWithEmailAndPassword(email, pass);
        } catch (regErr) {
          loginMsg.textContent = regErr.message || 'Registration failed.';
        }
      } else {
        loginMsg.textContent = err.message || 'Login failed.';
      }
    }
  }

  function handleLogout() {
    auth.signOut().catch(err => {
      alert('Logout error: ' + (err.message || err));
    });
  }

  async function handleAddBike() {
    bikeMsg.textContent = '';
    const user = auth.currentUser;
    if (!user) {
      bikeMsg.textContent = 'Please login again.';
      return;
    }

    const name   = bikeNameInp.value.trim();
    const engine = engineInp.value.trim();

    if (!name) {
      bikeMsg.textContent = 'Bike name is required.';
      return;
    }

    try {
      await db.collection('bikes').add({
        uid: user.uid,
        name,
        engine,
        created: firebase.firestore.FieldValue.serverTimestamp()
      });
      bikeNameInp.value = '';
      engineInp.value   = '';
      bikeMsg.textContent = 'Bike saved.';
    } catch (err) {
      bikeMsg.textContent = err.message || 'Failed to save bike.';
    }
  }

  function startBikeListener(uid) {
    stopBikeListener();
    bikesUnsub = db.collection('bikes')
      .where('uid', '==', uid)
      .orderBy('created', 'desc')
      .onSnapshot(snap => {
        bikeListTbody.innerHTML = '';
        snap.forEach(doc => {
          const b = doc.data();
          const tr = document.createElement('tr');
          const tdName = document.createElement('td');
          const tdEngine = document.createElement('td');
          tdName.textContent = b.name || '';
          tdEngine.textContent = b.engine || '';
          tr.appendChild(tdName);
          tr.appendChild(tdEngine);
          bikeListTbody.appendChild(tr);
        });
      }, err => {
        bikeMsg.textContent = err.message || 'Failed to load bikes.';
      });
  }

  function stopBikeListener() {
    if (typeof bikesUnsub === 'function') {
      bikesUnsub();
      bikesUnsub = null;
    }
  }

  loginBtn.addEventListener('click', handleLogin);
  logoutBtn.addEventListener('click', handleLogout);
  saveBikeBtn.addEventListener('click', handleAddBike);
</script>

</body>
</html>
